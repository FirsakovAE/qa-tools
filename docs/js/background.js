function d(t){return!!t&&(t.startsWith("http://")||t.startsWith("https://"))}class E{db=null;dbName="VueInspectorDB";storeName="settings";async init(){return new Promise((r,s)=>{const e=indexedDB.open(this.dbName,1);e.onerror=()=>{s(e.error)},e.onsuccess=()=>{this.db=e.result,r()},e.onupgradeneeded=i=>{const a=i.target.result;a.objectStoreNames.contains(this.storeName)||a.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1})}})}async saveSettings(r){return this.db||await this.init(),new Promise((s,e)=>{const a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),n={id:"user-settings",settings:r,version:r.version||"1.0.0",timestamp:Date.now()},c=a.put(n);c.onsuccess=()=>{s()},c.onerror=()=>{e(c.error)}})}async loadSettings(){return this.db||await this.init(),new Promise((r,s)=>{const a=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get("user-settings");a.onsuccess=()=>{const n=a.result;r(n?n.settings:null)},a.onerror=()=>{s(a.error)}})}async clearSettings(){return this.db||await this.init(),new Promise((r,s)=>{const a=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete("user-settings");a.onsuccess=()=>{r()},a.onerror=()=>{s(a.error)}})}}const o=new E;async function h(t){try{await chrome.storage.local.set({"vue-inspector-settings":t,"vue-inspector-settings-version":t.version||"1.0.0"})}catch{}}async function S(){try{let t=await o.loadSettings();return t?(await h(t),t):(t=(await chrome.storage.local.get(["vue-inspector-settings"]))["vue-inspector-settings"],t?(await o.saveSettings(t),t):null)}catch{return null}}async function l(t){try{await o.saveSettings(t),await h(t)}catch{}}async function T(t){try{const r=await chrome.tabs.get(t);if(!r||r.status!=="complete")return!1;const s=r.url||r.pendingUrl;return d(s)?(await Promise.race([chrome.tabs.sendMessage(t,{type:"PING"}),new Promise((i,a)=>setTimeout(()=>a(new Error("Ping timeout")),1e3))]))?.ready===!0:!1}catch{return!1}}async function u(t,r,s,e=3){if(await T(t))for(let a=0;a<e;a++)try{await chrome.tabs.sendMessage(t,r);return}catch(n){if((n?.message||"Unknown error").includes("Receiving end does not exist"))return;a<e-1&&await new Promise(I=>setTimeout(I,200*Math.pow(2,a)))}}chrome.runtime.onInstalled.addListener(async()=>{try{await o.init()}catch{}});chrome.runtime.onMessage.addListener((t,r,s)=>{switch(t.type){case"VUE_DETECTED":break;case"PINIA_DETECTED":break;case"PINIA_STORES_SUMMARY_DATA":case"PINIA_STORE_STATE_DATA":case"PINIA_PATCH_STATE_RESULT":case"PINIA_REPLACE_STATE_RESULT":case"PINIA_PATCH_GETTERS_RESULT":case"PINIA_CALL_ACTION_RESULT":case"PINIA_SEARCH_INDEX_READY":try{chrome.runtime.sendMessage(t).catch(()=>{})}catch{}break;case"GET_SETTINGS":return S().then(e=>{s(e||{})}).catch(e=>{s({})}),!0;case"UPDATE_SETTINGS":return l(t.settings).then(()=>{s({success:!0})}).catch(e=>{s({success:!1,error:e.message})}),!0;case"RESET_SETTINGS":return o.clearSettings().then(async()=>{await chrome.storage.local.remove(["vue-inspector-settings","vue-inspector-settings-version"]),s({success:!0})}).catch(e=>{s({success:!1,error:e.message})}),!0;case"SETTINGS_UPDATED":break;case"PING_CONTENT_SCRIPT":if(t.tabId)return T(t.tabId).then(e=>{s({ready:e})}).catch(e=>{s({ready:!1,error:e.message})}),!0;break;case"HIGHLIGHT_BY_UID":t.tabId&&u(t.tabId,{type:"HIGHLIGHT_BY_UID",uid:t.uid});break;case"HIGHLIGHT_ELEMENT":t.tabId&&u(t.tabId,{type:"HIGHLIGHT_ELEMENT",componentPath:t.componentPath});break;case"UNHIGHLIGHT_ELEMENT":t.tabId&&u(t.tabId,{type:"UNHIGHLIGHT_ELEMENT"});break}s({success:!0})});
